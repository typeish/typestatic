var SabeUI=function(){function o(a,b){var d=0,c;for(c in a)if(a[c][b]>d)d=a[c][b];return d}function k(a,b,d){$("#list-data > tbody").empty();$("#list-status-indicator").show();$("#list-status-text").hide();$("#list-status-text").empty();$("#details").hide();var c={},f="",i=function(){};p({list:b+":"+a});u(b+":"+a);if(b==="profile"){$("#list-title").html("Loading tags for: <span>"+a+"</span>");i=function(e){if(e.found){q=e.profile;l={};var r="";if(e.profile.num_tags_received===0&&e.profile.fetching_active){$("#list-status-text").html("Fetching initial lists for <strong>"+
e.profile.screen_name+"</strong> from Twitter. Wait a moment and the list will refresh.");$("#list-status-text").show();setTimeout("delayedGetObject('"+a+"', '"+b+"','"+e.profile.id+"')",5E3)}else{var v=o(e.top_tags,"count"),h;for(h in e.top_tags){l["tag-"+e.top_tags[h].slug]=e.top_tags[h].tag;e.top_tags[h].bar_percent=(e.top_tags[h].count/q.num_tags_received*100).toFixed(2);e.top_tags[h].bar_width=e.top_tags[h].count/v*s;r+=Mustache.to_html(m.list_item_tag,e.top_tags[h])}$("#list-status-indicator").hide()}$("#list-data > tbody").append(r);
$("#list-title").html("Top tags for: <span>"+e.profile.screen_name+"</span>");$("#details").show()}else{$("#list-status-indicator").hide();$("#list-status-text").html("<strong>"+a+"</strong> was not found. Please check spelling and try again.");$("#list-status-text").show()}};c={screen_name:a,with_top_tags:true};f="/api/profile/"}else if(b==="tag"){$("#list-title").html("Loading profiles for: <span>"+a+"</span>");i=function(e){if(e.tag&&e.profiles){q=e.tag;l={};var r="",v=o(e.profiles,"count"),h;
for(h in e.profiles){l["profile-"+e.profiles[h].profile.screen_name]=e.profiles[h].profile;var A={screen_name:e.profiles[h].profile.screen_name,list_completeness:(e.profiles[h].profile.list_completeness*100).toFixed(2)+"% of lists fetched",count:e.profiles[h].count,id:e.profiles[h].profile.id,bar_percent:(e.profiles[h].count/q.tag_count*100).toFixed(2),bar_width:e.profiles[h].count/v*s};r+=Mustache.to_html(m.list_item_profile,A)}$("#list-status-indicator").hide();$("#list-data > tbody").append(r);
$("#list-title").html("Top profiles tagged with: <span>"+e.tag.name+"</span>");$("#details").show()}else{$("#list-status-indicator").hide();$("#list-title").html("No profiles tagged with: <span>"+a+"</span>")}};c={slug:a};f="/api/tag/"}if(d)c.id=d;$.ajax({url:f,data:c,type:"GET",dataType:"json",success:i,error:function(){$("#list-status-indicator").hide();$("#list-status-text").html("There was a problem with the server. Please try again.");$("#list-status-text").show()}})}function y(a,b,d,c){$("#object-info").html(Mustache.to_html(a,
g));$("#object-list tbody").empty();a=o(d,"count");var f=0;f=g.screen_name?g.num_tags_received:g.tag_count;for(var i in d){d[i].bar_percent=(d[i].count/f*100).toFixed(2);d[i].bar_width=d[i].count/a*s;$("#object-list tbody").append(Mustache.to_html(b,d[i]))}$("#object-panel").attr({"class":c})}function t(){if(g){$("#object-info").empty();$("#object-list tbody").empty();$("#object-list h2").empty();$("#object-panel").attr({"class":""});$("#object-status-indicator").show();var a,b,d=[];if(g.screen_name){p({details:"profile:"+
g.screen_name});$.ajax({url:"/api/profile/",data:{id:g.id,with_top_tags:true},type:"GET",dataType:"json",success:function(c){if(c.profile){a=m.object_info_profile;b=m.object_list_profile;c.profile.klout_score=z(c.profile.klout_score,true);c.profile.whuffie=z(c.profile.whuffie,true);g=c.profile;d=c.top_tags;$("#object-status-indicator").hide();$("#object-list h2").text("top "+d.length+" tags");y(a,b,d,"profile")}},error:function(){$("#object-status-indicator").hide()}})}else{p({details:"tag:"+g.slug});
a=m.object_info_tag;b=m.object_list_tag;$.ajax({url:"/api/tag/",data:{id:g.id,slug:g.slug},type:"GET",dataType:"json",success:function(c){if(c.tag){g=c.tag;for(var f in c.profiles)d.push({screen_name:c.profiles[f].profile.screen_name,count:c.profiles[f].count,id:c.profiles[f].profile.id});$("#object-status-indicator").hide();$("#object-list h2").text("top "+d.length+" profiles");y(a,b,d,"tag")}},error:function(){$("#object-status-indicator").hide()}})}}}function B(a,b){if(g){$("#detail-"+a+" ul").append('<img src="/static/images/small-spinner.gif" />');
data=g.screen_name?{slug:a,screen_name:g.screen_name,order:"-list_subscribers"}:{slug:g.slug,screen_name:a,order:"-list_subscribers"};$.getJSON("/api/list-applieds/",data,function(d){var c="";if(d.applieds){for(var f in d.applieds){if(!d.applieds[f].list_description)d.applieds[f].list_description="no description";c+='<li><a href="http://twitter.com'+d.applieds[f].list_uri+'" target="_blank" title="'+d.applieds[f].list_description+'">'+d.applieds[f].list_uri+' &raquo;</a><span title="Subscribers">'+
d.applieds[f].list_subscribers+"</span></li>"}$("#detail-"+a+" img").remove();$("#detail-"+a+" ul").append(c);b.data("loaded",true)}})}}function p(a){if(a.details)n.details=a.details;if(a.list)n.list=a.list;window.location.hash="#list="+n.list+"&details="+n.details}function u(a){if(a!==j[j.length-1]){j.push(a);a="";for(var b=j.length-1;b>-1&&b>j.length-4;b--){j[b].split(":");a='<li class="list-crumb" target="'+[b]+'">&#92;'+j[b]+"</li>"+a}if(j.length>3)a='<li title="'+(j.length-3)+' more">&#8230;</li>'+
a;$("ul#list-crumbs").html(a)}}function z(a,b){for(var d=[[1E9,"b"],[1E6,"m"],[1E3,"k"],[1,""]],c="",f=1,i=0;i<d.length;i++){f=d[i][0];if(a>=f){c=d[i][1];break}}return b?(a/f).toFixed(0)+c:a/f+c}var q=undefined,l={},g=undefined,j=["-toptags"],s=35,n={details:"",list:""},m={object_info_profile:'<img src="{{ picture_url }}" /> <h1>{{ name }} (<a href="http://twitter.com/{{ screen_name }}/" target="_blank">@{{ screen_name }}</a>) <a href="{{ absolute_url }}" title="Permalink for {{ screen_name }}">&#8225;</a></h1> <p> {{ location_text }}<br /> <a href="{{ website }}" target="_blank">{{ website }}&nbsp;&raquo;</a> </p> <p>{{ description }}</p> <div id="stats"> <div id="wefollow"> <h2>WeFollow <a href="http://wefollow.com/{{ screen_name }}" target="_blank">&raquo;</a></h2> <p style="text-align: center">{{%IMPLICIT-ITERATOR iterator=wtag}}{{#wefollow_tags}}<span>{{wtag}}</span> {{/wefollow_tags}}{{^wefollow_tags}}&#8211;{{/wefollow_tags}}</p> </div> <div id="whuffie"> <h2>Whuffie <a href="http://thewhuffiebank.org/{{ screen_name }}" target="_blank">&raquo;</a></h2> {{ whuffie }} </div> <div id="klout"> <h2>Klout <a href="http://klout.com/{{ screen_name }}" target="_blank">&raquo;</a></h2> {{ klout_score }} </div> <div id="twitter-lists"> <h2># Twitter lists on</h2> {{ listed_count }} </div> <div id="unique-tags"> <h2>unique tags</h2> {{ num_unique_tags_received }} </div> <div id="total-tags"> <h2>total tags</h2> {{ num_tags_received }} </div> </div>',
object_info_tag:'<h1><span>tag:</span> {{ name }} <a href="{{ absolute_url }}" title="Permalink for {{ slug }}">&#8225;</a></h1> <p>{{ description }}</p> <div id="stats"> <div id="num-profiles"> <h2># profiles</h2> {{ aggregate_count }} </div> <div id="total-count"> <h2>total times used</h2> {{ tag_count }} </div> </div>',object_list_profile:'<tr><td class="load-lists" target="{{ slug }}">+</td><td id="detail-{{ slug }}" class="tag-name"><span id="{{ id }}">{{ slug }}</span><ul class="list-list"></ul></td><td class="count">{{ count }}</td><td class="bar-graph"><div style="width:{{ bar_width }}px; title="{{ bar_percent }}%"></div></td></tr>',
object_list_tag:'<tr><td class="load-lists" target="{{ screen_name }}">+</td><td id="detail-{{ screen_name }}" class="profile-name"><span id="{{ id }}">{{ screen_name }}</span><ul class="list-list"></ul></td><td class="count">{{ count }}</td><td class="bar-graph"><div style="width:{{ bar_width }}px;" title="{{ bar_percent }}%"></div></td></tr>',list_item_tag:'<tr id="tag-{{ slug }}"><td class="tag-name"><span id="{{ id }}">{{ slug }}</span></td><td class="count">{{ count }}</td><td class="bar-graph"><div style="width:{{ bar_width }}px;" title="{{ bar_percent }}%"></div></td><td class="load-details" title="Load details for {{ slug }}">&gt;</td></tr>',
list_item_profile:'<tr id="profile-{{ screen_name }}"><td class="profile-name"><span title="{{ list_completeness }}" id="{{ id }}">{{ screen_name }}</span></td><td class="count">{{ count }}</td><td class="bar-graph"><div style="width:{{ bar_width }}px;" title="{{ bar_percent }}%"></div></td><td class="load-details" title="Load details for {{ screen_name }}">&gt;</td></tr>'},w=function(){p({list:"-topprofiles"});u("-topprofiles");$("#list-data > tbody").empty();$("#list-status-indicator").show();$("#list-status-text").hide();
$("#list-status-text").empty();$("#details").hide();$.getJSON("/api/list-profiles/",{order:"-num_tags_received"},function(a){l={};var b="",d=o(a.profiles,"num_tags_received"),c;for(c in a.profiles){l["profile-"+a.profiles[c].screen_name]=a.profiles[c];b+=Mustache.to_html(m.list_item_profile,{bar_width:a.profiles[c].num_tags_received/d*s,screen_name:a.profiles[c].screen_name,count:a.profiles[c].num_tags_received,id:a.profiles[c].id})}$("#list-status-indicator").hide();$("#list-data > tbody").empty();
$("#list-data > tbody").append(b);$("#list-title").html("Top 20 Profiles")})},x=function(){p({list:"-toptags"});u("-toptags");$("#list-data > tbody").empty();$("#list-status-indicator").show();$("#list-status-text").hide();$("#list-status-text").empty();$("#details").hide();$.getJSON("/api/list-tags/",{order:"-tag_count"},function(a){l={};var b="",d=o(a.tags,"tag_count"),c;for(c in a.tags){l["tag-"+a.tags[c].slug]=a.tags[c];b+=Mustache.to_html(m.list_item_tag,{bar_width:a.tags[c].tag_count/d*s,slug:a.tags[c].slug,
count:a.tags[c].tag_count,id:a.tags[c].id})}$("#list-status-indicator").hide();$("#list-data > tbody").empty();$("#list-data > tbody").append(b);$("#list-title").html("Top 20 Tags")})};$("#list-data td.load-details").each(function(){$(this).html("&gt;");var a=$(this).attr("slug");$(this).click(function(){g={slug:a};t()})});(function(){var a=window.location.hash.substring(1);if(a){a=a.split("&");var b=a[0].replace("list=","");n.list=b;b=b.split(":");a=a[1].replace("details=","");n.details=a;a=a.split(":");
if(b[0]==="-toptags")x();else if(b[0]==="-topprofiles")w();else if(b[1]&&b[1]!=="")if(b[0]==="tag")k(b[1],"tag",undefined);else b[0]==="profile"&&k(b[1],"profile",undefined);if(a[1]&&a[1]!=="")if(a[0]==="tag"){g={slug:a[1]};t()}else if(a[0]==="profile"){data={screen_name:a[1]};url="/api/profile/";$.getJSON(url,data,function(d){if(d.profile){g=d.profile;t()}})}}})();(function(){$("#top-profiles").attr({href:"javascript:void(0);"});$("#top-tags").attr({href:"javascript:void(0);"});$("#top-profiles").click(w);
$("#top-tags").click(x);$("#details").click(function(){g=q;t()});$("#load-profile").click(function(){k($("#q").val(),"profile",undefined)});$("#load-tag").click(function(){k($("#q").val(),"tag",undefined)});$("#q").keyup(function(a){a.which===13&&$("#load-profile").click()});$("td.tag-name > span").live("click",function(){var a=$(this).attr("id");if(a.length===0)a=undefined;k($(this).text(),"tag",a)});$("#wefollow span").live("click",function(){k($(this).text(),"tag",undefined)});$("td.profile-name > span").live("click",
function(){var a=$(this).attr("id");if(a.length===0)a=undefined;k($(this).text(),"profile",a)});$("td.load-details").live("click",function(){g=l[$(this).parent().attr("id")];t()});$("td.load-lists").live("click",function(){var a=$(this).attr("target"),b=$(this).data("loaded");if($(this).hasClass("selected")){$(this).removeClass("selected");$(this).text("+");$("#detail-"+a+" ul").hide()}else{$(this).text("-");$(this).addClass("selected");$("#detail-"+a+" ul").show();b||B(a,$(this))}});$("li.list-crumb").live("click",
function(){for(var a=parseInt($(this).attr("target"),10),b=j.length-1;b>-1&&b>a;b--)j.pop();a=j.pop().split(":");if(a[0]==="-toptags")x();else if(a[0]==="-topprofiles")w();else if(a[1]&&a[1]!=="")if(a[0]==="tag")k(a[1],"tag",undefined);else a[0]==="profile"&&k(a[1],"profile",undefined)})})();window.delayedGetObject=k};